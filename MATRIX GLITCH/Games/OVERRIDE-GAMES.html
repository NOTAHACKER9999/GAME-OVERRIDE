<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Game Matrix</title>
<style>
html, body { margin:0; padding:0; width:100%; height:100%; background:black; color:white; font-family:Arial,sans-serif; overflow:hidden; }
#container { display:flex; height:100%; width:100%; }
.sidebar { width:220px; background:black; border-right:1px solid white; display:flex; flex-direction:column; overflow-y:auto; }
.search-bar { padding:10px; background:black; }
.search-bar input { width:100%; padding:6px; background:black; border:1px solid white; color:white; outline:none; }
.game-button { background:black; color:white; border:1px solid white; padding:10px; margin:2px 5px; text-align:center; cursor:pointer; flex-shrink:0; }
.game-button:hover { background:#222; }
.main { flex:1; display:flex; flex-direction:column; overflow:hidden; }
.topbar { background:#111; border-bottom:1px solid white; padding:10px; text-align:center; font-weight:bold; }
.content { flex:1; display:flex; flex-wrap:wrap; overflow-y:auto; padding:10px; gap:10px; justify-content:center; align-items:flex-start; }
.content .game-button { width:200px; }
.logo { position:fixed; bottom:10px; right:10px; width:120px; }
.game-area { position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.98); display:none; z-index:9999; flex-direction:column; }
.game-area iframe { flex:1; width:100%; height:100%; border:none; background:#000; }
.close-btn { position:fixed; top:15px; left:15px; background:red; color:#fff; border:none; font-size:28px; font-weight:bold; width:50px; height:50px; border-radius:50%; cursor:pointer; z-index:10000; }
.close-btn:hover { background:darkred; }
</style>
</head>
<body>
<div id="container">
  <div class="sidebar">
    <div class="search-bar"><input type="text" id="search" placeholder="Search games..."></div>
    <div id="sidebar-buttons"></div>
  </div>
  <div class="main">
    <div class="topbar">Recent Games</div>
    <div class="content" id="main-content"></div>
  </div>
</div>

<img class="logo" src="https://raw.githubusercontent.com/NOTAHACKER9999/GAME-OVERRIDE/refs/heads/main/MATRIX%20GLITCH/Logos/Glitch%20Override%20Logo.png">

<div class="game-area" id="game-area">
  <button class="close-btn" id="close-game">X</button>
  <iframe id="game-frame"></iframe>
</div>

<script>
(async function(){
const sidebarButtons = document.getElementById("sidebar-buttons");
const mainContent = document.getElementById("main-content");
const searchInput = document.getElementById("search");
const gameArea = document.getElementById("game-area");
const gameFrame = document.getElementById("game-frame");
const closeGame = document.getElementById("close-game");

let games = [];

// Fetch games list
async function fetchGames() {
  try {
    const res = await fetch("https://override-games.th15isar0bothi.workers.dev/");
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    games = await res.json();
  } catch(e){
    console.error("Fetch failed:", e);
    games = [
      {name:"Demo Game", raw_url:"https://raw.githubusercontent.com/NOTAHACKER9999/GAME-OVERRIDE/main/MATRIX%20GLITCH/Games/Embed%20Games/Angry%20birds.html"}
    ];
  }
  renderSidebar(games);
  renderRandomGames();
}

// Render sidebar buttons
function renderSidebar(list){
  sidebarButtons.innerHTML="";
  if(list.length===0){ sidebarButtons.textContent="No games"; return; }
  list.sort((a,b)=>a.name.localeCompare(b.name)).forEach(game=>{
    const btn = document.createElement("div");
    btn.className="game-button";
    btn.textContent=game.name.replace(".html","");
    btn.onclick=()=>openGame(game.raw_url);
    sidebarButtons.appendChild(btn);
  });
}

// Render main content
function renderRandomGames(){
  mainContent.innerHTML="";
  if(games.length===0){ mainContent.textContent="No games"; return; }
  [...games].sort(()=>0.5-Math.random()).slice(0,20).forEach(game=>{
    const btn = document.createElement("div");
    btn.className="game-button";
    btn.textContent=game.name.replace(".html","");
    btn.onclick=()=>openGame(game.raw_url);
    mainContent.appendChild(btn);
  });
}

// Open overlay and run fetched HTML
async function openGame(url){
  try{
    const res = await fetch(url);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    let html = await res.text();

    // Only add <base> if none exists
    if(!/<base\s/i.test(html)){
      const baseTag = `<base href="${url.substring(0,url.lastIndexOf("/")+1)}">`;
      html = html.replace(/(<head[^>]*>)/i, `$1${baseTag}`);
    }

    const blob = new Blob([html], {type:'text/html'});
    const blobURL = URL.createObjectURL(blob);
    gameFrame.src = blobURL;
    gameArea.style.display="flex";

    closeGame.onclick = ()=>{
      gameArea.style.display="none";
      gameFrame.src="";
      URL.revokeObjectURL(blobURL);
    };
  } catch(err){
    console.error("Game load failed:", err);
    gameFrame.srcdoc = `<html><body style="background:black;color:white;"><h2>Error loading game</h2><pre>${err}</pre></body></html>`;
    gameArea.style.display="flex";
    closeGame.onclick = ()=>{ gameArea.style.display="none"; gameFrame.srcdoc=""; };
  }
}

// Search
searchInput.addEventListener("input", ()=>{
  const query = searchInput.value.toLowerCase();
  renderSidebar(games.filter(g=>g.name.toLowerCase().includes(query)));
});

fetchGames();
})();
</script>
</body>
</html>
